{"version":3,"sources":["webpack:////Users/user/zhjian20210728/devzhijian/zhijianliwu/components/anil-seat/anil-seat.vue?a4f8","webpack:////Users/user/zhjian20210728/devzhijian/zhijianliwu/components/anil-seat/anil-seat.vue?10bc","webpack:////Users/user/zhjian20210728/devzhijian/zhijianliwu/components/anil-seat/anil-seat.vue?a087","webpack:////Users/user/zhjian20210728/devzhijian/zhijianliwu/components/anil-seat/anil-seat.vue?d82e","uni-app:///components/anil-seat/anil-seat.vue","webpack:////Users/user/zhjian20210728/devzhijian/zhijianliwu/components/anil-seat/anil-seat.vue?724f"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","l0","_self","_c","SelectNum","Math","min","max","_isMounted","e0","$event","num","_temp","arguments","length","currentTarget","dataset","_temp2","eventParams","smartChoose","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped"],"mappings":";;;;2DAAA,wRACIA,EADJ,qMASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,qCACZ,aAAAF,E;;;;2GCvBf,+yC;;;;2GCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACQ,IAAlBN,EAAIO,UAAkBC,KAAKC,IAAIT,EAAIU,IAAK,GAAK,MAEjDV,EAAIW,aACPX,EAAIY,GAAK,SAASC,EAAQC,GACxB,IAAIC,EAAQC,UAAUA,UAAUC,OAAS,GAAGC,cAAcC,QACxDC,EAASL,EAAMM,aAAeN,EAAM,gBACpCD,EAAMM,EAAON,IAIf,OAAOd,EAAIsB,YAAYR,EAAM,KAIjCd,EAAIuB,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACLvB,GAAIA,MAKRwB,GAAmB,EACnBC,EAAkB,GACtB9B,EAAO+B,eAAgB,G;;;;2DC9BvB,+4BAAu1B,eAAG,G;;;;0pCCiF11B,CACE,KAAF,YACE,MAAF,CACI,SAAJ,CACM,KAAN,OAEI,IAAJ,CACM,KAAN,OACM,QAAN,GAEI,MAAJ,CACM,KAAN,OACM,QAAN,IAEI,KAAJ,CACM,KAAN,OACM,QAAN,IAEI,SAAJ,CACM,KAAN,OACM,QAAN,KAGE,KAvBF,WAwBI,MAAJ,CACM,SAAN,EACM,SAAN,IACM,MAAN,IACM,UAAN,GACM,QAAN,EACM,QAAN,EACM,SAAN,EACM,UAAN,EACM,MAAN,EACM,MAAN,EACM,OAAN,EACM,OAAN,EACM,SAAN,EACM,SAAN,GACM,KAAN,GACM,OAAN,GACM,SAAN,IAGA,UACA,OADA,WAEM,IAAN,KAIA,OAHA,kCACQ,EAAR,4FAEA,GAEA,OARA,WASA,0BAEA,MAXA,WAYA,2BAGA,QA3DA,WA2DA,WAEA,iBACA,oBACA,4BAMA,iBAEA,SACA,oBACA,IADA,EACA,gBAEA,IACA,IACA,wBACA,wBANA,IAOA,GAPA,IAOA,0CACA,4CACA,4CACA,4CACA,6CAXA,8BAaA,gBACA,mBACA,mBACA,cACA,gBAEA,sBAGA,oCACA,4EACA,QACA,YACA,UACA,kBAEA,iBACA,8BACA,yDACA,+CACA,yBAGA,4BACA,4BACA,yBACA,gBACA,QACA,gBACA,KACA,kBACA,MAEA,yEACA,OACA,uBACA,mBACA,yBACA,kBAGA,yBACA,SACA,gBACA,IADA,EACA,KADA,IAEA,MAFA,IAEA,0CACA,aACA,aAJA,8BAOA,EACA,UAEA,WAGA,aAGA,oBACA,gBAEA,uBACA,mBACA,eACA,2BACA,cACA,kBAIA,mBACA,gBACA,uBAGA,qBACA,iBACA,eAGA,IADA,6BACA,uBACA,+BACA,mBACA,gBAIA,kBAGA,mBACA,oBAUM,KAAN,8BAGA,+BACM,QAAN,SACA,gCACA,iBAEA,kBAEA,SACA,eACA,iBACA,+BACA,UACQ,GAAR,yBACU,OAAV,aACY,MAAZ,sBACY,KAAZ,SAGQ,EAAR,iBACQ,EAAR,iBACA,eACA,iBACA,0BAGA,2BAIA,wBACM,QAAN,OACA,kBACA,SACA,eACA,UACA,SACA,uBACA,yBACA,aAGA,IAEA,uBAGA,wBAGA,iBAEA,wCAEA,iDACA,cAGA,OAFA,wBACA,mBAIA,0CACA,mBACA,wBACA,yBAFA,GAYA,sCAwBA,IALA,SAEA,UACA,UAEA,cAIA,IAFA,SACA,MACA,0BAEA,iDAEA,yBACA,uCAEA,MACA,IAEA,qCAKA,QACA,SACA,WAMA,UACA,KACA,MAoBA,OAnBA,EAEA,uBACA,aACA,WACA,eAKA,iCACA,aACA,WACA,eAMA,GAMA,6CAEA,IADA,SACA,aACA,kCACA,KACA,MAGA,UAGA,kCAEA,IADA,SACA,aACA,cAEA,UAGA,uBACA,YAEA,IAFA,IACA,yBACA,mBAEQ,EAAR,mCACQ,EAAR,mCACA,2BACA,sCAEA,oB;;;;2DCpcA,+jDAAghD,eAAG,G","file":"components/anil-seat/anil-seat.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./anil-seat.vue?vue&type=template&id=27ac6c0a&\"\nvar renderjs\nimport script from \"./anil-seat.vue?vue&type=script&lang=js&\"\nexport * from \"./anil-seat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./anil-seat.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/anil-seat/anil-seat.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./anil-seat.vue?vue&type=template&id=27ac6c0a&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.SelectNum === 0 ? Math.min(_vm.max, 6) : null\n\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event, num) {\n      var _temp = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp2 = _temp.eventParams || _temp[\"event-params\"],\n        num = _temp2.num\n\n      var _temp, _temp2\n\n      return _vm.smartChoose(num + 1)\n    }\n  }\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./anil-seat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./anil-seat.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"sel-seat\">\r\n    <!-- top -->\r\n    <view class=\"seat-head\">\r\n      <text class=\"sh-title\">{{ title }}</text>\r\n      <text class=\"sh-info\">{{ info }}</text>\r\n    </view>\r\n    <!-- main -->\r\n    <view class=\"seat-main\">\r\n      <movable-area :style=\"'height:'+(seatRow*40+350)+'rpx;'\" class=\"vm-area\">\r\n        <movable-view :style=\"'width: 750rpx;height:'+(seatRow*40+350)+'rpx;'\" :inertia=\"true\" :scale=\"true\" :scale-min=\"0.95\"\r\n\t\t\t\t :scale-max=\"2\" direction=\"all\" @change=\"onMove\" @scale=\"onScale\">\r\n          <view class=\"sm-title\">\r\n          \t<text class=\"text\">{{ roomName }}</text>\r\n          </view>\r\n          <view class=\"sm-screen\">\r\n            <text class=\"text\">银幕中央</text>\r\n          </view>\r\n          <view class=\"sm-line-center\"></view>\r\n          <!-- seat content -->\r\n          <view v-for=\"(item,index) in seatArray\" :key=\"index\" \r\n            class=\"sm-cell\" :style=\"'width:'+boxWidth+'px;height:'+seatSize+'px'\">\r\n          \t<view v-for=\"(seat,col) in item\" :key=\"col\" class=\"dp-ib\" :style=\"'width:'+seatSize+'px;height:'+seatSize+'px'\"\r\n          \t @click=\"handleChooseSeat(index,col)\">\r\n          \t\t<image v-if=\"seat.type===0\" class=\"sm-icon\" src=\"https://zhijianlw.com/static/web/img/icon_film_2021_10_28_01.png\" mode=\"aspectFit\"></image>\r\n          \t\t<image v-else-if=\"seat.type===1\" class=\"sm-icon\" src=\"https://zhijianlw.com/static/web/img/icon_film_2021_10_28_02.png\" mode=\"aspectFit\"></image>\r\n          \t\t<image v-else-if=\"seat.type===2\" class=\"sm-icon\" src=\"https://zhijianlw.com/static/web/img/icon_film_2021_10_28_03.png\" mode=\"aspectFit\"></image>\r\n          \t</view>\r\n          </view>\r\n          <view class=\"sm-line-index\" :style=\"'left: '+(10-moveX/scale)+'px;'\">\r\n          \t<text class=\"text\" :style=\"'height:'+seatSize+'px;'\" v-for=\"(m,mindex) in mArr\"\r\n          \t :key=\"mindex\">{{m}}</text>\r\n          </view>\r\n        </movable-view>\r\n      </movable-area>\r\n      <view class=\"fix-tips\" v-if=\"showTis\">\r\n      \t<view class=\"v-tips\">\r\n      \t\t<image :style=\"'width:'+seatSize+'px;height:'+seatSize+'px'\" src=\"https://zhijianlw.com/static/web/img/icon_film_2021_10_28_01.png\" mode=\"aspectFit\"></image>\r\n          <text class=\"text\">可选</text>\r\n      \t</view>\r\n      \t<view class=\"v-tips\">\r\n      \t\t<image :style=\"'width:'+seatSize+'px;height:'+seatSize+'px'\" src=\"https://zhijianlw.com/static/web/img/icon_film_2021_10_28_02.png\" mode=\"aspectFit\"></image>\r\n          <text class=\"text\">不可选</text>\r\n      \t</view>\r\n      \t<view class=\"v-tips\">\r\n      \t\t<image :style=\"'width:'+seatSize+'px;height:'+seatSize+'px'\" src=\"https://zhijianlw.com/static/web/img/icon_film_2021_10_28_03.png\" mode=\"aspectFit\"></image>\r\n          <text class=\"text\">选中</text>\r\n      \t</view>\r\n      </view>\r\n    </view>\r\n    <!-- foot -->\r\n    <view class=\"seat-foot\">\r\n      <view class=\"sf-recommend\" v-if=\"SelectNum === 0\">\r\n        <text class=\"text\">推荐选座</text>\r\n        <view class=\"sfr-tag\" v-for=\"num in Math.min(max, 6)\" :key=\"num\"\r\n          @click=\"smartChoose(num+1)\">\r\n          <text class=\"text\">{{ num+1 }}人</text>\r\n        </view>\r\n      </view>\r\n      <view class=\"sf-arselect\" v-else>\r\n        <text class=\"text\">已选</text>\r\n        <scroll-view scroll-x=\"true\">\r\n          <view class=\"scr-wrap\">\r\n            <view class=\"sfr-selt\" v-for=\"(optItem,optindex) in optArr\" :key=\"optItem.SeatCode\"\r\n              @click=\"handleChooseSeat(optItem.rowIndex, optItem.colIndex)\">\r\n              <!-- <image src=\"/static/close.png\" class=\"sfr-close\"></image> -->\r\n              <text class=\"text\">{{optItem.RowNum+'排'+optItem.ColumnNum+'座'}}</text>\r\n              <text class=\"price\">￥{{ optItem.Price || '' }}</text>\r\n              <view class=\"sfr-close\">X</view>\r\n            </view>\r\n          </view>\r\n        </scroll-view>\r\n      </view>\r\n      <view class=\"f-btn\" :class=\"{disabled: SelectNum === 0 }\" @click=\"buySeat\">\r\n        <text class=\"text\">{{SelectNum === 0 ? '请选座位' : `￥ ${aPrice} 确认座位`}}</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n    name:\"anil-seat\",\r\n    props: {\r\n      seatData: {\r\n        type: Array\r\n      },\r\n      max: {\r\n        type: Number,\r\n        default: 4\r\n      },\r\n      title: {\r\n        type: String,\r\n        default: ''\r\n      },\r\n      info: {\r\n        type: String,\r\n        default: ''\r\n      },\r\n      roomName: {\r\n        type: String,\r\n        default: ''\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        scaleMin:1,//h5端为解决1无法缩小问题，设为0.95\r\n        boxWidth: 400, //屏幕宽度px\r\n        space: ' ', //空格\r\n        seatArray: [], //影院座位的二维数组,-1为非座位，0为未购座位，1为已选座位(绿色),2为已购座位(红色),一维行，二维列\r\n        seatRow: 0, //影院座位行数\r\n        seatCol: 0, //影院座位列数\r\n        seatSize: 0, //座位尺寸\r\n        SelectNum: 0, //选择座位数\r\n        moveX: 0, //水平移动偏移量\r\n        scale: 1, //放大倍数\r\n        minRow: 0, //从第几行开始排座位\r\n        minCol: 0, //从第几列开始排座位\r\n        showTis: true, //显示选座提示\r\n        seatList: [], //接口获取的原始位置\r\n        mArr: [], //排数提示\r\n        optArr: [], //选中的座位数组。\r\n        isWXAPP:false,\r\n      };\r\n    },\r\n\t\tcomputed: {\r\n\t\t\taPrice() {\r\n        let totalAmount = ''\r\n        if (this.optArr && this.optArr.length) {\r\n          totalAmount = this.optArr.map(item => Number(item.Price)).reduce((prev, curr) => prev + curr)\r\n        }\r\n\t\t\t\treturn totalAmount\r\n\t\t\t},\r\n\t\t\trpxNum() {\r\n\t\t\t\treturn this.boxWidth / 750\r\n\t\t\t},\r\n\t\t\tpxNum() {\r\n\t\t\t\treturn 750 / this.boxWidth\r\n\t\t\t},\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\t//获取宽度\r\n\t\t\tuni.getSystemInfo({\r\n\t\t\t\tsuccess: (e) => {\r\n\t\t\t\t\tthis.boxWidth = e.screenWidth\r\n\t\t\t\t\t//#ifdef H5\r\n\t\t\t\t\tthis.scaleMin = 0.95\r\n\t\t\t\t\t//#endif\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.initData()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tinitData: function() {\r\n\t\t\t\tlet arr = this.seatData\r\n\t\t\t\t//假数据说明：SeatCode座位编号，RowNum-行号，ColumnNum-纵号，YCoord-Y坐标，XCoord-X坐标，Status-状态\r\n\t\t\t\tlet row = 0\r\n\t\t\t\tlet col = 0\r\n\t\t\t\tlet minCol = parseInt(arr[0].XCoord)\r\n\t\t\t\tlet minRow = parseInt(arr[0].YCoord)\r\n\t\t\t\tfor (let i of arr) {\r\n\t\t\t\t\tminRow = parseInt(i.YCoord) < minRow ? parseInt(i.YCoord) : minRow\r\n\t\t\t\t\tminCol = parseInt(i.XCoord) < minCol ? parseInt(i.XCoord) : minCol\r\n\t\t\t\t\trow = parseInt(i.YCoord) > row ? parseInt(i.YCoord) : row\r\n\t\t\t\t\tcol = parseInt(i.XCoord) > col ? parseInt(i.XCoord) : col\r\n\t\t\t\t}\r\n\t\t\t\tthis.seatList = arr\r\n\t\t\t\tthis.seatRow = row - minRow + 1\r\n\t\t\t\tthis.seatCol = col - minCol + 3\r\n\t\t\t\tthis.minRow = minRow\r\n\t\t\t\tthis.minCol = minCol - 1\r\n\r\n\t\t\t\tthis.initSeatArray()\r\n\t\t\t},\r\n\t\t\t//初始座位数组\r\n\t\t\tinitSeatArray: function() {\r\n\t\t\t\tlet seatArray = Array(this.seatRow).fill(0).map(() => Array(this.seatCol).fill({\r\n\t\t\t\t\ttype: -1,\r\n\t\t\t\t\tSeatCode: '',\r\n\t\t\t\t\tRowNum: '',\r\n\t\t\t\t\tColumnNum: ''\r\n\t\t\t\t}));\r\n\t\t\t\tthis.seatArray = seatArray\r\n\t\t\t\tthis.seatSize = this.boxWidth > 0 ?\r\n\t\t\t\t\tparseInt(parseInt(this.boxWidth, 10) / (this.seatCol + 1), 10) :\r\n\t\t\t\t\tparseInt(parseInt(414, 10) / (this.seatCol + 1), 10)\r\n\t\t\t\tthis.initNonSeatPlace();\r\n\t\t\t},\r\n\t\t\t//初始化是座位的地方\r\n\t\t\tinitNonSeatPlace: function() {\r\n\t\t\t\tlet seat = this.seatList.slice()\r\n\t\t\t\tlet arr = this.seatArray.slice()\r\n\t\t\t\tfor (let num in seat) {\r\n\t\t\t\t\tlet status = 2 //-1为非座位，0为未购座位，1为已选座位(绿色),2为已购座位(红色)\r\n\t\t\t\t\tif (seat[num].Status === 0) {\r\n\t\t\t\t\t\tstatus = 0\r\n\t\t\t\t\t} else if (seat[num].Status === -1) {\r\n\t\t\t\t\t\tstatus = -1\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarr[parseInt(seat[num].YCoord) - this.minRow][parseInt(seat[num].XCoord) - this.minCol] = {\r\n\t\t\t\t\t\ttype: status,\r\n\t\t\t\t\t\tSeatCode: seat[num].SeatCode,\r\n\t\t\t\t\t\tRowNum: seat[num].RowNum,\r\n\t\t\t\t\t\tColumnNum: seat[num].ColumnNum,\r\n\t\t\t\t\t\tPrice: seat[num].Price,\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.seatArray = arr.slice()\r\n\t\t\t\tlet mArr = []\r\n\t\t\t\tfor (let i in arr) {\r\n\t\t\t\t\tlet m = ''\r\n\t\t\t\t\tfor (let n of arr[i]) {\r\n\t\t\t\t\t\tif (n.SeatCode) {\r\n\t\t\t\t\t\t\tm = n.RowNum\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (m) {\r\n\t\t\t\t\t\tmArr.push(m)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmArr.push('')\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.mArr = mArr\r\n\t\t\t},\r\n\t\t\t//放大缩小事件\r\n\t\t\tonScale: function(e) {\r\n\t\t\t\tthis.showTis = false\r\n\t\t\t\t// this.moveX=-e.detail.x\r\n\t\t\t\tlet w = this.boxWidth * 0.5\r\n\t\t\t\tlet s = 1 - e.detail.scale\r\n\t\t\t\tthis.moveX = w * s\r\n\t\t\t\tthis.scale = e.detail.scale\r\n\t\t\t\tif (s > 0 || s === 0) {\r\n\t\t\t\t\tthis.showTis = true\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//移动事件\r\n\t\t\tonMove: function(e) {\r\n\t\t\t\tthis.showTis = false\r\n\t\t\t\tthis.moveX = e.detail.x\r\n\t\t\t},\r\n\t\t\t//重置座位\r\n\t\t\tresetSeat: function() {\r\n\t\t\t\tthis.SelectNum = 0\r\n\t\t\t\tthis.optArr = []\r\n\t\t\t\t//将所有已选座位的值变为0\r\n\t\t\t\tlet oldArray = this.seatArray.slice();\r\n\t\t\t\tfor (let i = 0; i < this.seatRow; i++) {\r\n\t\t\t\t\tfor (let j = 0; j < this.seatCol; j++) {\r\n\t\t\t\t\t\tif (oldArray[i][j].type === 1) {\r\n\t\t\t\t\t\t\toldArray[i][j].type = 0\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.seatArray = oldArray;\r\n\t\t\t},\r\n\t\t\t//选定且购买座位\r\n\t\t\tbuySeat: function() {\r\n\t\t\t\tif (this.SelectNum === 0) return;\r\n\t\t\t\t// let oldArray = [];\r\n\t\t\t\t// for (let i = 0; i < this.seatRow; i++) {\r\n\t\t\t\t// \tfor (let j = 0; j < this.seatCol; j++) {\r\n\t\t\t\t// \t\tif (this.seatArray[i][j].type === 1) {\r\n\t\t\t\t// \t\t\toldArray.push(this.seatArray[i][j])\r\n\t\t\t\t// \t\t}\r\n\t\t\t\t// \t}\r\n\t\t\t\t// }\r\n        // console.log(this.optArr)\r\n        this.$emit('confirm', this.optArr)\r\n\t\t\t},\r\n\t\t\t//处理座位选择逻辑\r\n\t\t\thandleChooseSeat: function(row, col) {\r\n        console.log(row, col)\r\n\t\t\t\tlet seatValue = this.seatArray[row][col].type;\r\n\t\t\t\tlet newArray = this.seatArray;\r\n\t\t\t\t//如果是已购座位，直接返回\r\n\t\t\t\tif (seatValue === 2 || seatValue === -1) return\r\n\t\t\t\t//如果是已选座位点击后变未选\r\n\t\t\t\tif (seatValue === 1) {\r\n\t\t\t\t\tnewArray[row][col].type = 0\r\n\t\t\t\t\tthis.SelectNum--\r\n\t\t\t\t\tthis.getOptArr(newArray[row][col], 0)\r\n\t\t\t\t} else if (seatValue === 0) {\r\n          if (this.SelectNum >= this.max) {\r\n            return uni.showToast({\r\n              title: '一次最多选择' + this.max + '张',\r\n              icon: 'none'\r\n            })\r\n          }\r\n          newArray[row][col].rowIndex = row\r\n          newArray[row][col].colIndex = col\r\n\t\t\t\t\tnewArray[row][col].type = 1\r\n\t\t\t\t\tthis.SelectNum++\r\n\t\t\t\t\tthis.getOptArr(newArray[row][col], 1)\r\n\t\t\t\t}\r\n\t\t\t\t//必须整体更新二维数组，Vue无法检测到数组某一项更新,必须slice复制一个数组才行\r\n\t\t\t\tthis.seatArray = newArray.slice();\r\n\t\t\t\r\n\t\t\t},\r\n\t\t\t//处理已选座位数组\r\n\t\t\tgetOptArr: function(item, type) {\r\n        console.log(item)\r\n\t\t\t\tlet optArr = this.optArr\r\n\t\t\t\tif (type === 1) {\r\n\t\t\t\t\toptArr.push(item)\r\n\t\t\t\t} else if (type === 0) {\r\n\t\t\t\t\tlet arr = []\r\n\t\t\t\t\toptArr.forEach(v => {\r\n\t\t\t\t\t\tif (v.SeatCode !== item.SeatCode) {\r\n\t\t\t\t\t\t\tarr.push(v)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\toptArr = arr\r\n\t\t\t\t}\r\n\t\t\t\tthis.optArr = optArr.slice()\r\n\t\t\t},\r\n\t\t\t//推荐选座,参数是推荐座位数目，\r\n\t\t\tsmartChoose: function(num) {\r\n\t\t\t\t// console.log('num===', num)\r\n\t\t\t\t// 先重置\r\n\t\t\t\tthis.resetSeat()\r\n\t\t\t\t//找到影院座位水平垂直中间位置的后一排\r\n\t\t\t\tlet rowStart = parseInt((this.seatRow - 1) / 2, 10) + 1;\r\n\t\t\t\t//先从中间排往后排搜索\r\n\t\t\t\tlet backResult = this.searchSeatByDirection(rowStart, this.seatRow - 1, num);\r\n\t\t\t\tif (backResult.length > 0) {\r\n\t\t\t\t\tthis.chooseSeat(backResult);\r\n\t\t\t\t\tthis.SelectNum += num\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t//再从中间排往前排搜索\r\n\t\t\t\tlet forwardResult = this.searchSeatByDirection(rowStart - 1, 0, num);\r\n\t\t\t\tif (forwardResult.length > 0) {\r\n\t\t\t\t\tthis.chooseSeat(forwardResult);\r\n\t\t\t\t\tthis.SelectNum += num\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t//提示用户无合法位置可选\r\n        // #ifdef H5\r\n\t\t\t\talert('无合法位置可选!')\r\n        // #endif\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t//搜索函数,参数:fromRow起始行，toRow终止行,num推荐座位数\r\n\t\t\tsearchSeatByDirection: function(fromRow, toRow, num) {\r\n\t\t\t\t/*\r\n\t\t\t\t * 推荐座位规则\r\n\t\t\t\t * (1)初始状态从座位行数的一半处的后一排的中间开始向左右分别搜索，取离中间最近的，如果满足条件，\r\n\t\t\t\t *    记录下该结果离座位中轴线的距离，后排搜索完成后取距离最小的那个结果座位最终结果，优先向后排进行搜索，\r\n\t\t\t\t *    后排都没有才往前排搜，前排逻辑同上\r\n\t\t\t\t *\r\n\t\t\t\t * (2)只考虑并排且连续的座位，不能不在一排或者一排中间有分隔\r\n\t\t\t\t *\r\n\t\t\t\t * */\r\n\r\n\t\t\t\t/*\r\n\t\t\t\t * 保存当前方向搜索结果的数组,元素是对象,result是结果数组，offset代表与中轴线的偏移距离\r\n\t\t\t\t * {\r\n\t\t\t\t *   result:Array([x,y])\r\n\t\t\t\t *   offset:Number\r\n\t\t\t\t * }\r\n\t\t\t\t *\r\n\t\t\t\t */\r\n\t\t\t\tlet currentDirectionSearchResult = [];\r\n\r\n\t\t\t\tlet largeRow = fromRow > toRow ? fromRow : toRow,\r\n\t\t\t\t\tsmallRow = fromRow > toRow ? toRow : fromRow;\r\n\r\n\t\t\t\tfor (let i = smallRow; i <= largeRow; i++) {\r\n\t\t\t\t\t//每一排的搜索,找出该排里中轴线最近的一组座位\r\n\t\t\t\t\tlet tempRowResult = [],\r\n\t\t\t\t\t\tminDistanceToMidLine = Infinity;\r\n\t\t\t\t\tfor (let j = 0; j <= this.seatCol - num; j++) {\r\n\t\t\t\t\t\t//如果有合法位置\r\n\t\t\t\t\t\tif (this.checkRowSeatContinusAndEmpty(i, j, j + num - 1)) {\r\n\t\t\t\t\t\t\t//计算该组位置距离中轴线的距离:该组位置的中间位置到中轴线的距离\r\n\t\t\t\t\t\t\tlet resultMidPos = parseInt((j + num / 2), 10);\r\n\t\t\t\t\t\t\tlet distance = Math.abs(parseInt(this.seatCol / 2) - resultMidPos);\r\n\t\t\t\t\t\t\t//如果距离较短则更新\r\n\t\t\t\t\t\t\tif (distance < minDistanceToMidLine) {\r\n\t\t\t\t\t\t\t\tminDistanceToMidLine = distance;\r\n\t\t\t\t\t\t\t\t//该行的最终结果\r\n\t\t\t\t\t\t\t\ttempRowResult = this.generateRowResult(i, j, j + num - 1)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//保存该行的最终结果\r\n\t\t\t\t\tcurrentDirectionSearchResult.push({\r\n\t\t\t\t\t\tresult: tempRowResult,\r\n\t\t\t\t\t\toffset: minDistanceToMidLine\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//处理后排的搜索结果:找到距离中轴线最短的一个\r\n\t\t\t\t//注意这里的逻辑需要区分前后排，对于后排是从前往后，前排则是从后往前找\r\n\t\t\t\tlet isBackDir = fromRow < toRow;\r\n\t\t\t\tlet finalReuslt = [],\r\n\t\t\t\t\tminDistanceToMid = Infinity;\r\n\t\t\t\tif (isBackDir) {\r\n\t\t\t\t\t//后排情况,从前往后\r\n\t\t\t\t\tcurrentDirectionSearchResult.forEach((item) => {\r\n\t\t\t\t\t\tif (item.offset < minDistanceToMid) {\r\n\t\t\t\t\t\t\tfinalReuslt = item.result;\r\n\t\t\t\t\t\t\tminDistanceToMid = item.offset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//前排情况，从后往前找\r\n\t\t\t\t\tcurrentDirectionSearchResult.reverse().forEach((item) => {\r\n\t\t\t\t\t\tif (item.offset < minDistanceToMid) {\r\n\t\t\t\t\t\t\tfinalReuslt = item.result;\r\n\t\t\t\t\t\t\tminDistanceToMid = item.offset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//直接返回结果\r\n\t\t\t\treturn finalReuslt\r\n\t\t\t},\r\n\r\n\t\t\t/*辅助函数，判断每一行座位从i列到j列是否全部空余且连续\r\n\t\t\t *\r\n\t\t\t */\r\n\t\t\tcheckRowSeatContinusAndEmpty: function(rowNum, startPos, endPos) {\r\n\t\t\t\tlet isValid = true;\r\n\t\t\t\tfor (let i = startPos; i <= endPos; i++) {\r\n\t\t\t\t\tif (this.seatArray[rowNum][i].type !== 0) {\r\n\t\t\t\t\t\tisValid = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn isValid\r\n\t\t\t},\r\n\t\t\t//辅助函数：返回每一行的某个合理位置的座位数组\r\n\t\t\tgenerateRowResult: function(row, startPos, endPos) {\r\n\t\t\t\tlet result = [];\r\n\t\t\t\tfor (let i = startPos; i <= endPos; i++) {\r\n\t\t\t\t\tresult.push([row, i])\r\n\t\t\t\t}\r\n\t\t\t\treturn result\r\n\t\t\t},\r\n\t\t\t//辅助函数:智能推荐的选座操作\r\n\t\t\tchooseSeat: function(result) {\r\n\t\t\t\tlet opt = this.optArr\r\n\t\t\t\tlet oldArray = this.seatArray.slice();\r\n\t\t\t\tfor (let i = 0; i < result.length; i++) {\r\n\t\t\t\t\t//选定座位\r\n          oldArray[result[i][0]][result[i][1]].rowIndex = result[i][0]\r\n          oldArray[result[i][0]][result[i][1]].colIndex = result[i][1]\r\n\t\t\t\t\toldArray[result[i][0]][result[i][1]].type = 1\r\n\t\t\t\t\tthis.optArr.push(oldArray[result[i][0]][result[i][1]])\r\n\t\t\t\t}\r\n\t\t\t\tthis.seatArray = oldArray;\r\n\t\t\t},\r\n\t\t}\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.sel-seat {\r\n  display: flex;\r\n  flex-direction: column;\r\n  width: 100%;\r\n  height: 100vh;\r\n  .seat-head {\r\n    background-color: #ffffff;\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: 20rpx 30rpx;\r\n    position: relative;\r\n    z-index: 5;\r\n    .sh-title {\r\n      font-size: 32rpx;\r\n      font-weight: bold;\r\n      color: #333333;\r\n    }\r\n    .sh-info {\r\n      font-size: 24rpx;\r\n      color: #999999;\r\n      margin-top: 10rpx;\r\n    }\r\n  }\r\n  .seat-main {\r\n    width: 100%;\r\n    position: relative;\r\n    padding: 10rpx;\r\n    .vm-area {\r\n      width: 750rpx;\r\n    }\r\n    .sm-title {\r\n      background-color: #dddddd;\r\n      width: 380rpx;\r\n      height: 34rpx;\r\n      transform: perspective(34rpx) rotateX(-10deg);\r\n      margin: 0 auto;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: relative;\r\n      z-index: 2;\r\n      .text {\r\n        font-size: 24rpx;\r\n        color: #333333;\r\n      }\r\n    }\r\n    .sm-screen {\r\n      width: 100rpx;\r\n      height: 30rpx;\r\n      border: 1rpx solid #cccccc;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      margin: 48rpx auto 0;\r\n      border-radius: 4rpx;\r\n      position: relative;\r\n      z-index: 1;\r\n      .text {\r\n        font-size: 20rpx;\r\n        color: #999999;\r\n      }\r\n    }\r\n    .sm-line-center {\r\n      height: 610rpx;\r\n      width: 0;\r\n      border: 1rpx dashed #e5e5e5;\r\n      position: fixed;\r\n      left: 50%;\r\n      top: 0;\r\n      display: block;\r\n      z-index: 0;\r\n      transform: translateX(-50%);\r\n    }\r\n    .fix-tips {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      font-size: 24rpx;\r\n      position: fixed;\r\n      bottom: 214rpx;\r\n      left: 0;\r\n      width: 100%;\r\n      z-index: 1;\r\n      padding: 20rpx;\r\n      .v-tips {\r\n        display: flex;\r\n        align-items: center;\r\n        color: #999;\r\n        margin: 0 10rpx;\r\n        .text {\r\n          margin-left: 10rpx;\r\n        }\r\n      }\r\n    }\r\n    // seat style\r\n    .sm-cell {\r\n      display: flex;\r\n      margin-top: 20rpx;\r\n      align-items: center;\r\n      justify-content: center;\r\n      position: relative;\r\n      z-index: 2;\r\n      .sm-icon {\r\n        width: 100%;\r\n        height: 100%;\r\n      }\r\n    }\r\n    .sm-line-index {\r\n      position: fixed;\r\n      top: 114rpx;\r\n      left: 20rpx;\r\n      border-radius: 14rpx;\r\n      overflow: hidden;\r\n      background-color: rgba($color: #000000, $alpha: 0.3);\r\n      z-index: 3;\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n      justify-content: center;\r\n      padding-bottom: 20rpx;\r\n      width: 30rpx;\r\n      .text {\r\n        font-size: 24rpx;\r\n        color: #ffffff;\r\n        width: 100%;\r\n        text-align: center;\r\n        margin-top: 20rpx;\r\n      }\r\n    }\r\n  }\r\n  .seat-foot {\r\n    margin-top: auto;\r\n    background-color: #ffffff;\r\n    padding: 20rpx 30rpx;\r\n    position: relative;\r\n    z-index: 5;\r\n    .sf-recommend {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      padding-bottom: 20rpx;\r\n      .text {\r\n        font-size: 28rpx;\r\n        color: #666666;\r\n      }\r\n      .sfr-tag {\r\n        width: 110rpx;\r\n        height: 60rpx;\r\n        border-radius: 4rpx;\r\n        border: 1rpx solid #ccc;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-left: 20rpx;\r\n      }\r\n    }\r\n    .sf-arselect {\r\n      @extend .sf-recommend;\r\n      .text {\r\n        font-size: 24rpx;\r\n        color: #666666;\r\n      }\r\n      .price {\r\n        font-size: 20rpx;\r\n        color: red;\r\n      }\r\n      .scr-wrap {\r\n        display: flex;\r\n        white-space: nowrap;\r\n      }\r\n      .sfr-selt {\r\n        min-width: 130rpx;\r\n        height: 60rpx;\r\n        border-radius: 4rpx;\r\n        border: 1rpx solid #ccc;\r\n        display: flex;\r\n        align-items: flex-start;\r\n        justify-content: center;\r\n        flex-direction: column;\r\n        margin-left: 20rpx;\r\n        position: relative;\r\n        margin-left: 20rpx;\r\n        padding-left: 10rpx;\r\n        .sfr-close {\r\n          position: absolute;\r\n          right: 6rpx;\r\n          top: 10rpx;\r\n          font-size: 20rpx;\r\n          color: #999;\r\n        }\r\n      }\r\n    }\r\n    .f-btn {\r\n      background-color: #F45664;\r\n      width: 100%;\r\n      height: 90rpx;\r\n      line-height: 90rpx;\r\n      text-align: center;\r\n      border-radius: 10rpx;\r\n      .text {\r\n        color: #ffffff;\r\n        font-size: 36rpx;\r\n      }\r\n      &.disabled {\r\n        opacity: .8;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./anil-seat.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./anil-seat.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}